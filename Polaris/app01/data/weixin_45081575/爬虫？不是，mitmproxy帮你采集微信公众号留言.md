
--- 
title:  çˆ¬è™«ï¼Ÿä¸æ˜¯ï¼Œmitmproxyå¸®ä½ é‡‡é›†å¾®ä¿¡å…¬ä¼—å·ç•™è¨€ 
tags: []
categories: [] 

---
## å‰è¨€

>  
 æœ‰ä½æœ‹å‹éœ€è¦æ”¶é›†å…¬å¸å¾®ä¿¡å…¬ä¼—å·çš„æ–‡ç« çš„ç•™è¨€ï¼Œä½†è‹¦äºå¾®ä¿¡å…¬ä¼—å¹³å°æ²¡æœ‰æä¾›ç•™è¨€çš„`API`ï¼Œæ‰€ä»¥æœ‹å‹éœ€è¦åœ¨æ¯ä¸€ç¯‡æ–‡ç« ä¸‹é¢å»æ‰‹åŠ¨å¤åˆ¶ç²˜è´´ï¼Œæœ‹å‹è§‰å¾—å¾ˆéº»çƒ¦ï¼Œäºæ˜¯æ¥æ‰¾åˆ°æˆ‘ï¼é‚æœ‰æ­¤æ–‡ã€‚ 


ä¸‹ä¸€ç¯‡ï¼Œå°†ç»“åˆ`uiautomation`ï¼Œå®ç°å…¨è‡ªåŠ¨åŒ–æ”¶é›†å¾®ä¿¡å…¬ä¼—å·ç•™è¨€

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå€ŸåŠ©`mitmproxy`ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¦æˆªæ„Ÿå…´è¶£çš„æµé‡ï¼Œä½†åœ¨è¿™é‡Œå……å…¶é‡å°±æ˜¯èŠ‚çœäº†æˆ‘ä»¬æ‰‹åŠ¨å¤åˆ¶çš„éº»çƒ¦ï¼Œ`mitmproxy`åœ¨è¿™é‡Œçš„è§’è‰²å°±æ˜¯`æ‹·è´å¿è€…`ã€‚

## çŸ¥è¯†ç‚¹ğŸ“–ğŸ“–

å…³äº`mitmproxy`ï¼Œè¿˜éœ€è¦å®‰è£…é…ç½®ã€‚å‚è€ƒä¸‹é¢é“¾æ¥ï¼š 

æœ¬æ–‡ä¸»è¦ä½¿ç”¨çš„æ˜¯ `mitmproxy`ï¼Œå…³äºå®ƒçš„ä½¿ç”¨ï¼Œå¯ä»¥
- çœ‹å®˜æ–¹æ–‡æ¡£ï¼š- çœ‹æˆ‘å½•åˆ¶çš„è§†é¢‘ï¼š
## å®ç°

>  
 æœ¬æ–‡çš„é‡ç‚¹åœ¨äºå®šä½åˆ°ç•™è¨€çš„æµé‡ï¼ˆå³ç•™è¨€çš„æ•°æ®åŒ… 


æ‰“å¼€ `charles` æŠ“åŒ…å·¥å…·ï¼Œçœ‹çœ‹ç•™è¨€çš„æµé‡ï¼Œå› ä¸ºæ¯”è¾ƒç®€å•ï¼Œä¸€çœ¼å°±æ‰¾åˆ°äº†å¯¹åº”æµé‡åŒ…ã€‚ ç°åœ¨çŸ¥é“äº†ç•™è¨€çš„æµé‡åŒ…ï¼Œå¤åˆ¶å®ƒçš„`URL`ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨`mitmproxy`å»æ‹¦æˆªå®ƒï¼Œç„¶åå†åšä¿å­˜å°±å¯ä»¥äº†ã€‚

<img src="https://img-blog.csdnimg.cn/7e1560d39a4045f1a8d1af1c4cae5f8a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">

ç°åœ¨å» `chatGPT` é—®é—®å¼ºå¤§çš„å®ƒï¼Œä»£ç è¯¥æ€ä¹ˆå†™ã€‚

**mitmproxyç›‘å¬å¾®ä¿¡å…¬ä¼—å·ç•™è¨€çš„ä»£ç **

<img src="https://img-blog.csdnimg.cn/53d6dbe6882846cc8e4ec8ac8f6f3a2e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">

çœ‹åˆ°ä¸Šå›¾ï¼Œå¼ºå¤§çš„`chatGPT`è¿ä»£ç éƒ½ç»™æˆ‘ä»¬å†™å‡ºæ¥äº†ã€‚ æˆ‘ä»¬å…³å¿ƒçš„æ˜¯å“åº”ï¼Œæ‰€ä»¥å–ä¸Šé¢çš„`response`å‡½æ•°ï¼Œç„¶åæ›¿æ¢é‡Œé¢çš„`URL`å³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

<img src="https://img-blog.csdnimg.cn/e1aeaa2a6fc44e26aa29922c8923d52b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">

ç„¶ååœ¨æ§åˆ¶å°çª—å£è¿è¡Œå®ƒï¼ˆè®°å¾—æ‰“å¼€ç”µè„‘ä»£ç†ï¼š
- å‚æ•°ä¸åšè§£é‡Š
```
mitmdump -s listen_comment.py -q

```

å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼Œæ‹¦æˆªæˆåŠŸã€‚é‚£æ¥ä¸‹æ¥çš„å·¥ä½œå°±åªå‰©ä¸‹æ•°æ®è§£æäº†ã€‚

<img src="https://img-blog.csdnimg.cn/1521e4b60c4445d9adc3d330abf94c8e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">

ä»£ç çš„è§£æå¾ˆç®€å•ï¼Œè¿™é‡Œå°±ä¸å†åšä»‹ç»äº†ã€‚

## ä»£ç 

>  
 ä¸‹é¢çš„ä»£ç è¿˜æ²¡èƒ½ä¿å­˜æ•°æ®ï¼è¿˜éœ€è°ƒç”¨ä¸€ä¸‹`parse`å‡½æ•°å™¢ï¼ï¼ï¼ 


åœ¨å‘½ä»¤è¡Œçª—å£è¾“å…¥ï¼š`mitmdump -s listen_comment.py -q`ï¼Œå³å¯è¿è¡Œæœ¬ç¨‹åº

```
# listen_comment.py

# å¯¼å…¥å¿…è¦çš„åº“
from mitmproxy import http


# å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¤„ç†æ¯ä¸€ä¸ªå“åº”
def response(flow: http.HTTPFlow) -&gt; None:
    # åˆ¤æ–­å“åº”çš„URLæ˜¯å¦æ˜¯å…¬ä¼—å·ç•™è¨€çš„URL
    if "https://mp.weixin.qq.com/mp/appmsg_comment?action=getcomment&amp;scene=0" in flow.request.url:
        # è·å–å“åº”çš„æ•°æ®åŒ…
        response = flow.response
        # æ‰“å°å‡ºå“åº”çš„çŠ¶æ€ç å’Œå†…å®¹
        print(f"Status: {<!-- -->response.status_code}")
        print(f"Content: {<!-- -->response.content}")
        print(parse(data=response.text))


def parse(data: str):
    """è§£æç•™è¨€æµé‡åŒ…"""
    _data = defaultdict(list)
    try:
        for item in json.loads(data)['elected_comment']:
            _data['nick_name'].append(item['nick_name'])
            _data['content'].append(item['content'])
            _data['like_num'].append(item['like_num'])
            _data['province_name'].append(item['ip_wording']['province_name'])
    except (KeyError, json.decoder.JSONDecodeError):
        ...
    finally:
        return _data

addons = [response]


```

## åè¯

æœ¬æ¬¡åˆ†äº«åˆ°è¿™é‡Œç»“æŸäº†ï¼Œ å–„äºåˆ©ç”¨å·¥å…·ï¼Œå°±å¯ä»¥å®ç°åŒ…æ‹¬ä½†ä¸é™äºæœ¬æ–‡ä¹‹ç±»çš„æ“ä½œå•¦ï¼ see you~ğŸ±â€ğŸğŸ±â€ğŸ
