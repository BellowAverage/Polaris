
--- 
title:  封装外部D3D游戏选择菜单 
tags: []
categories: [] 

---
所谓外部D3D绘制，其实现原理是，通过在外部创建顶层窗体，并每隔指定毫秒数，自动附加窗体到目标进程上，我们所有的绘制操作都是在自身进程上实现的。

这种方式绘制出来的方框或菜单，都有一个显著的特点，首先占用CPU过高，且当有其他窗体覆盖到游戏顶层时，则绘制出来的菜单或方框将会被置顶，见如下效果：

<img alt="" src="https://img-blog.csdnimg.cn/img_convert/757531f6cc6b506612083b17019265e8.png">

至于外部绘制如何监控热键，我们可以使用`RegisterHotKey(NULL, 1, 0, VK_UP);`注册，由于是外部，因此不需要热键回调，所以只需要注册即可全局生效。

菜单的绘制，很简单，首先一个外包矩形，矩形的大小需要自己计算得到，你有几个功能则矩形就需要有多长，矩形内部嵌套一个小矩形，当用户按下上下左右时，我们默认让其自动移动位置，这个移动位置是通过下标计算得出的偏移，根据计算的得出的偏移值，从而实现动态移动，当用户选中某个菜单项时，则全局变量负责接收，并判断功能即可。



#### 内部D3D绘制模块(封装外部D3D游戏选择菜单)

相对于外部D3D绘制模块来说，则不存在以上问题，与外部绘制不同，内部绘制需要控制转接函数，在原始绘图函数工作之前，需要增加新的绘制方法，内部绘制效率时最高的，且内部绘制不存在占用CPU资源高的情况，一般绘制出来的效果如下：

<img alt="" src="https://img-blog.csdnimg.cn/img_convert/b9df1352a2946c0cb8974d288f4f72cd.png">

如上，很明显内部绘制与父进程已经融合了，并不存在挡住的情况，但内部绘制使用`RegisterHotKey()`无法注册热键，需要将自身热键注册到父窗体回调事件中才可以，所以代码上也需要增加一些。
