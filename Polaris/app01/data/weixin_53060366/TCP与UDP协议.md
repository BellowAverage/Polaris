
--- 
title:  TCP与UDP协议 
tags: []
categories: [] 

---
## TCP与UDP协议

### 1、TCP协议：

#### 1、TCP特性：
- TCP 提供一种**面向连接的、可靠的**字节流服务。- 在一个 TCP 连接中，仅有两方进行彼此通信。广播和多播不能用于 TCP。- TCP 使用校验和，确认和重传机制来保证可靠传输。- TCP 给数据分节进行排序，并使用累积确认保证数据的顺序不变和非重复。- TCP 使用滑动窗口机制来实现流量控制，通过动态改变窗口的大小进行拥塞控制。
>  
 滑动窗口协议，属于的一种应用，用于网络数据传输时的流量控制，以避免拥塞的发生。该协议允许发送方在停止并等待确认前发送多个数据分组。由于发送方不必每发一个分组就停下来等待确认。因此该协议可以加速数据的传输，提高。 


总的来说，**TCP 协议是通过序列号、确认应答、重发控制、连接管理以及窗口控制等机制实现数据稳定可靠性的传输**。

#### 2、TCP协议的报文格式：

<img src="https://img-blog.csdnimg.cn/3300f8b5c1e1449f9f2330cad4709a0b.png#pic_center" alt="在这里插入图片描述">

TCP 报文段包括协议首部和数据两部分，协议首部的固定部分是 20 个字节，头部是固定部分，后面是选项部分。

>  
 - 源端口号以及目的端口号：各占 2 个字节，端口是传输层和应用层的服务接口，用于寻找发送端和接收端的进程，一般来讲，通过端口号和IP地址，可以唯一确定一个 TCP 连接，在网络编程中，通常被称为一个 **socket 接口**。- 序号：**Seq 序号**，占 4 个字节。用来标识从 TCP 发送端向 TCP 接收端发送的数据字节流序号，发起方发送数据时对此进行标记。- 确认序号：**Ack 序号**，占 4 个字节，包含接受端所期望收到的下一个序号。只有 ACK 标记位为 1 时，确认序号字段才有效，因此，确认序号应该是上次已经成功收到数据字节序号加 1，即 Ack = Seq + 1。- 数据偏移：占 4 个字节，用于指出 TCP 首部长度。- 保留字段：占 6 位，暂时可忽略，值全为 0。- 六位标志位：值内容含义如下- 窗口：占 2 个字节，用于流量控制和拥塞控制，表示当前接收缓冲区的大小。- 校验和：占 2 个字节，范围包括首部和数据两部分- 紧急指针：指出了紧急数据的末尾在报文段中的位置，和 URG 搭配使用- 选项和填充：是可选的，默认情况是不选。 


#### 3、TCP三次握手：

计算机之间使用 TCP 协议进行传输数据时，每次连接都需要经过 3 个阶段：**创建连接、数据传送和释放连接**，即传输数据之前，在发送端和接收端建立逻辑连接、然后传输数据、最后断开连接，它保证两台计算机之间比较可靠的数据传输。

1、创建连接：

当两个设备之间准备传输数据之前，TCP 会建立连接，创建连接的阶段需要三次握手。

<img src="https://img-blog.csdnimg.cn/3758720e29b4452e9d7ca4985a6050c3.png#pic_center" alt="在这里插入图片描述">

详细过程如下：
- 第一次握手：客户端向服务器端发出连接请求，等待服务器确认。- 第二次握手：服务器端收到请求后，向客户端回送一个确认，通知客户端收到了连接请求。- 第三次握手：客户端再次向服务器端发送确认信息，确认连接。
完成以上 3 次握手之后，可靠性连接建立完成，就可以进行数据传输了。

#### 4、TCP四次挥手：

1、释放连接：当数据传输完毕之后，TCP 会释放连接，连接的释放需要四次挥手。

<img src="https://img-blog.csdnimg.cn/0d79ef1930ba4c70938970fdf5206de1.png#pic_center" alt="在这里插入图片描述">
- 第一次挥手：客户端向服务器端发出请求切断连接，等待服务器确认。- 第二次挥手：服务器端收到请求后，向客户端回送一个确认信息，并同意关闭请求。- 第三次挥手：服务器端再次向客户端发出请求切断连接，等待客户端确认。- 第四次挥手：客户端收到请求后，向服务器端回送一个确认信息，并同意关闭请求。
#### 5、重传机制介绍：

当网络不稳定的时候，很容易出现数据包丢失，TCP 采用了哪些重传手段来解决数据包丢失问题呢？

常见的重传方式有以下几种：
- 超时重传- 快速重传- SACK- D-SACK<li> 超时重传： 超时重传，顾名思义，就是在发送数据时，设定一个定时器，当超过指定的时间后，没有收到对方的 ACK 确认应答报文，就会重发数据。 TCP 会在以下两种情况发生超时重传： 
  1. 发送的数据包丢失。1. 确认应答丢失。 那如何来设定超时重传的时间呢？ 
  1. RTT：指的是数据从网络的一端传送到另一端所需要的时间，也就是数据包发送出去的往返时间。1. RTO：超时重传时间。 1）当RTO较大时，重传时间间隔就会比较大，会出现数据传输效率差的现象，比如数据包丢失之后，需要等很长时间才重发，性能差； 2）当RTO较小时，可能会出现并没有丢失包就重发，多次重发会造成网络拥堵，导致出现更多的超时，更多的超时意味着更多的重发； 3）TCP每当遇到一次超时重传的时候，会将下一次超时时间间隔设为先前值的两倍，多次超时说明网络环境差，不宜频繁反复重发。 </li><li> 快速重传： 
  1.  **快速重传就是来补充超时重传机制中时间过长的问题**。 1.  快速重传不像超时重传那样通过时间来驱动重发，而是通过次数来驱动重发。 1.  当收到报文重复的 ACK 数量，到达一定的阀值（一般为3），TCP 会在定时器过期之前，检查丢失的报文段并重传丢失的报文段。  </li>1.  SACK方法： 具体实现就是需要在 TCP 头部选项字段里加一个 SACK 的东西，接受方可以将缓存的数据地图发送给发送方，这样发送方就可以知道哪些数据收到了，哪些数据没收到，知道了这些信息，就可以只重传丢失的数据。 <mark>注意：如果要支持 SACK 机制，必须发送方和接受方都要支持。在 Linux 操作系统中，开发者可以通过`net.ipv4.tcp_sack`参数打开这个功能（Linux 2.4 后默认打开）。</mark> 1.  Duplicate SACK 方法： `D-SACK`，这个方法实现主要是使用 `SACK`和`ACK`来告诉发送方有哪些数据被重复接收了，以防止 TCP 反复的重发。 使用`D-SACK`方法的好处，可以让发送方知道，是发出去的包丢了还是接收方回应的 ACK 包丢了，然后来决定是否需要继续重发包。 在 Linux 操作系统下，可以通过`net.ipv4.tcp_dsack`参数来开启/关闭这个功能（Linux 2.4 后默认打开）。 - RTT：指的是数据从网络的一端传送到另一端所需要的时间，也就是数据包发送出去的往返时间。- RTO：超时重传时间。
### 2、UDP协议：

#### 1、简介

UDP协议是一种在计算机网络中广泛使用的传输层协议。与TCP协议相比，UDP协议具有更轻量级、无连接和不可靠的特点。

UDP协议基于IP协议，它提供了一种简单的数据传输机制。与TCP协议不同，UDP协议不需要在通信双方建立可靠的连接。它通过将数据划分为一系列称为"数据报"的小块来传输数据。每个数据报都包含了源端口号、目标端口号、数据长度和校验和等信息。

<img src="https://img-blog.csdnimg.cn/c5288edf9685433092649a72669819f9.png#pic_center" alt="在这里插入图片描述">

#### 2、UDP协议工作原理：
- 应用程序将数据传递给UDP协议。- UDP协议将数据封装成数据报，并加上源端口号和目标端口号等信息。- 数据报通过网络传输到目标主机。- 目标主机的UDP协议接收数据报，并将数据传递给目标应用程序。
#### 3、UDP协议特点：
1.  无连接性：UDP协议在通信之前不需要建立连接，数据报直接发送给目标主机，从而降低了通信的延迟。 1.  面向报文：UDP协议将应用程序传递给它的数据封装成独立的数据报进行传输，每个数据报都是独立的实体，不会进行拆分和重组。 1.  不可靠性：UDP协议不提供数据的可靠传输，数据报在传输过程中可能会丢失、重复、乱序等。它不保证数据的完整性和顺序性，也不提供重传机制。 1.  简单高效：由于UDP协议的简单性，它的开销相对较小，传输效率较高。适用于一些对传输速度要求较高、但对数据完整性要求不那么严格的应用场景。 
#### 4、UDP协议的应用：
- 实时音视频传输。- DNS解析。- 游戏应用。- loT设备通信。- 广播和多播。