
--- 
title:  第07课：基于 Redis 的分布式锁实现及其踩坑案例 
tags: []
categories: [] 

---
分布式锁的实现，目前常用的方案有以下三类：

 1. 数据库乐观锁；
 1. 基于分布式缓存实现的锁服务，典型代表有 Redis 和基于 Redis 的 RedLock；
 1. 基于分布式一致性算法实现的锁服务，典型代表有 ZooKeeper、Chubby 和 ETCD。

>  
 基于 Redis 实现分布式锁，网上可以查到很多相关资料，我最初也借鉴了这些资料，但是，在分布式锁的实现和使用过程中意识到这些资料普遍存在问题，容易误导初学者，鉴于此，撰写了本文，希望为对分布式锁感兴趣的读者提供一篇切实可用的参考文档。 


#### 1. 分布式锁原理介绍

##### 1.1 分布式锁基本约束条件

为了确保锁服务可用，通常，分布式锁需同时满足以下四个约束条件。

 1. 互斥性：在任意时刻，只有一个客户端能持有锁；
 1. 安全性：即不会形成死锁，当一个客户端在持有锁的期间崩溃而没有主动解锁的情况下，其持有的锁也能够被正确释放，并保证后续其它客户端能加锁；
 1. 可用性：就 Redis 而言，当提供锁服务的 Redis Master 节点发生宕机等不可恢复性故障时，Slave 节点能够升主并继续提供服务，支持客户端加锁和解锁；对基于分布式一致性算法实现的锁服务（如 ETCD）而言，当 Leader 节点宕机时，Follow 节点能够选举出新的 Leader 继续提供锁服务；
 1. 对称性：对于任意一个锁，其加锁和解锁必须是同一个客户端，即客户端 A 不能把客户端 B 加的锁
